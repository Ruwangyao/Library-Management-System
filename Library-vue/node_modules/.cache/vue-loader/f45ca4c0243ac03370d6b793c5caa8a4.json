{"remainingRequest":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\borrower\\BookList\\index.vue?vue&type=style&index=0&id=7aa710a6&scoped=true&lang=scss","dependencies":[{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\borrower\\BookList\\index.vue","mtime":1654054537000},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1749726397077},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1749726394932},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":1749726394615},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1749726393347},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749726397539},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1749726393897}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5ib29rTGlzdHsKICBwYWRkaW5nOiAwIDIwcHggMzBweCAyMHB4OwogIGhlaWdodDogMTAwJTsKICAuZWwtZm9ybXsKICAgIC5lbC1mb3JtLWl0ZW17CiAgICAgIC5lbC1pbnB1dHsKICAgICAgICB3aWR0aDogMjAwcHg7CiAgICAgIH0KICAgIH0KICB9CiAgLmVsLXRhYmxlewogICAgLm9wZXJhdGlvbnsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIGhlaWdodDogMTAwJTsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgID4qewogICAgICAgIG1hcmdpbjogMCAycHggMTBweCAycHg7CiAgICAgIH0KICAgIH0KICB9CiAgLmVsLXBhZ2luYXRpb257CiAgICBtYXJnaW4tdG9wOiAxMHB4OwogICAgOjp2LWRlZXB7CiAgICAgIC5lbC1wYWdlcnsKICAgICAgICAmPmxpOm5vdCguaXMtYWN0aXZlKXsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwogICAgICAgIH0KICAgICAgfQogICAgICAmPi5idG4tcHJldiwmPi5idG4tbmV4dHsKICAgICAgICAmOm5vdChbZGlzYWJsZWRdKXsKICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICAuYm9ycm93RGlhbG9nOjp2LWRlZXB7CiAgICAmPmRpdnsKICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICB9CiAgICAmPmRpdjpub3QoOmxhc3QtY2hpbGQpewogICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgfQogIH0KfQo="},{"version":3,"sources":["D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\borrower\\BookList\\index.vue"],"names":[],"mappings":";AA8OA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACP,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACzB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACN,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;MACd;IACF;EACF;EACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACR,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;MACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;MACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;MACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACtB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACnB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACvB,CAAC,CAAC;QACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MACxB;IACF;EACF;EACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IAChB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACN,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;UAClB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QACzB;MACF;MACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACrB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;UACf,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QACzB;MACF;IACF;EACF;EACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACnB,CAAC,CAAC,CAAC,CAAC,CAAC;MACH,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IACnB;IACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACpB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IACrB;EACF;AACF","file":"D:/桌面/前端交互/final/LibraryManagementSystem-master/Library-vue/src/views/borrower/BookList/index.vue","sourceRoot":"","sourcesContent":["<template>\n  <div class=\"bookList\">\n    <el-form :inline=\"true\" :model=\"queryForm\" label-position=\"left\">\n      <el-form-item label=\"ISBN\">\n        <el-input v-model=\"queryForm.isbn\" placeholder=\"按ISBN号筛选\" clearable></el-input>\n      </el-form-item>\n      <el-form-item label=\"标题\">\n        <el-input v-model=\"queryForm.name\" placeholder=\"按标题筛选\" clearable ></el-input>\n      </el-form-item>\n      <el-form-item label=\"作者\">\n        <el-input v-model=\"queryForm.author\" placeholder=\"按作者筛选\" clearable ></el-input>\n      </el-form-item>\n      <el-form-item label=\"分类\">\n        <el-select v-model=\"queryForm.typeId\" placeholder=\"选择图书分类\" clearable>\n          <el-option\n              v-for=\"type in bookTypeList\" :key=\"type.id\"\n              :label=\"type.name\" :value=\"type.id\">\n          </el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"queryBook\">查询</el-button>\n      </el-form-item>\n    </el-form>\n    <el-table :data=\"bookList\" border stripe highlight-current-row ref=\"tableRef\">\n      <el-table-column label=\"序号\" fixed=\"left\" align=\"center\" type=\"index\" :index=\"indexMethod\"></el-table-column>\n      <el-table-column fixed=\"left\" label=\"分类\" prop=\"typeName\"></el-table-column>\n      <el-table-column fixed=\"left\" label=\"ISBN\" prop=\"isbn\"></el-table-column>\n      <el-table-column fixed=\"left\" label=\"封面\" align=\"center\">\n        <template #default=\"{row}\">\n          <el-image :src=\"row.coverImg\">\n            <template #error>\n                <el-icon><icon-picture /></el-icon>\n            </template>\n          </el-image>\n        </template>\n      </el-table-column>\n      <el-table-column fixed=\"left\" label=\"名称\" prop=\"name\"></el-table-column>\n      <el-table-column label=\"作者\" prop=\"author\"></el-table-column>\n      <el-table-column label=\"出版社\" prop=\"press\"></el-table-column>\n      <el-table-column label=\"定价\" prop=\"price\"></el-table-column>\n      <el-table-column label=\"出版日期\" prop=\"publishTime\"></el-table-column>\n      <el-table-column label=\"数量\" prop=\"stockNum\" align=\"center\"></el-table-column>\n      <el-table-column label=\"操作\" align=\"center\" fixed=\"right\">\n        <template #default=\"{row}\">\n          <div class=\"operation\">\n            <el-button v-if=\"row.stockNum !== 0\" type=\"primary\" @click=\"openBorrowBookDialog(row.id)\">借阅</el-button>\n            <el-button v-else type=\"success\" @click=\"openReserveBookDialog(row.id)\">预定</el-button>\n            <el-button type=\"info\" @click=\"getBookDetail(row.id)\">查看详情</el-button>\n          </div>\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-pagination\n        background layout=\"total, prev, pager, next\"\n        :total=\"pagination.total\"\n        :page-size=\"pagination.limit\"\n        v-model:current-page=\"pagination.current\"\n        @current-change=\"pageChange\"/>\n\n    <el-dialog v-model=\"borrowBookVisible\" title=\"借阅图书\" :draggable=\"true\" destroy-on-close>\n      <template #footer>\n        <el-button @click=\"borrowBookVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"borrowBook\">确定</el-button>\n      </template>\n      <div class=\"borrowDialog\">\n        <div>是否借阅该图书?</div>\n        <div>\n          选择借阅的天数：<el-input-number v-model=\"borrowBookForm.borrowTime\" :min=\"1\" :max=\"30\" size=\"small\" ></el-input-number>\n        </div>\n        <div>已借阅情况：{{`${UserInfoStore.borrowedNum}/${UserInfoStore.borrowMaxNum}`}}</div>\n      </div>\n    </el-dialog>\n\n    <el-dialog v-model=\"reserveBookVisible\" title=\"预定图书\" :draggable=\"true\" destroy-on-close>\n      <template #footer>\n        <el-button @click=\"reserveBookVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"reserveBook\">确定</el-button>\n      </template>\n      <div class=\"reserveBook\">\n        <div>是否预定该图书?</div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport {useRouter} from 'vue-router'\nimport {onMounted, shallowReactive, shallowRef, onBeforeMount, markRaw} from 'vue'\nimport {getPageBookInfoApi,getBookTypeApi,borrowBookApi,reserveBookApi} from \"@/api/borrower\";\nimport { Picture as IconPicture } from '@element-plus/icons-vue'\nimport  {ElLoading,ElMessage} from 'element-plus'\nimport {useUserInfoStore} from \"@/store/useUserInfoStore\";\n\nexport default {\n  name: \"BookList\",\n  components:{\n    IconPicture\n  },\n  setup(){\n    // 存储图书信息的数组\n    const bookList = shallowReactive([])\n    // 表单对象，用于显示加载动画\n    const tableRef = shallowRef()\n    // 获取图书信息\n    function getPageBookInfo(){\n      // 先清空数据\n      bookList.splice(0,bookList.length)\n      const loadingInstance = ElLoading.service({\n        target: tableRef.value.$el,\n      })\n      getPageBookInfoApi(pagination.current,pagination.limit,queryForm)\n          .then(res=>{\n            if(Array.isArray(res.data.records)){\n              bookList.push(...res.data.records)\n              pagination.total = res.data.total\n            }\n          })\n          .finally(()=>{\n            loadingInstance.close()\n          })\n    }\n    onMounted(()=>{\n      getPageBookInfo()\n    })\n\n    // 分页数据\n    const pagination = shallowReactive({\n      current: 1,\n      limit: 15,\n      total: 0\n    })\n    // 页码改变的事件\n    function pageChange(){\n      getPageBookInfo()\n    }\n    function indexMethod(index){\n      return index + 1 + (pagination.current-1) * pagination.limit\n    }\n\n\n    // 筛选条件的表单\n    const queryForm = shallowReactive({\n      isbn: '',\n      author: '',\n      name: '',\n      typeId: ''\n    })\n    // 存储图书分类的数组\n    const bookTypeList = shallowReactive([])\n    function getBookType(){\n      getBookTypeApi()\n        .then(res=>{\n          if(Array.isArray(res.data.types)){\n            bookTypeList.splice(0,bookTypeList.length,...res.data.types)\n          }\n        })\n    }\n    // 提交表单查询图书信息\n    function queryBook(){\n      if(pagination.current !== 1) {\n        pagination.current = 1\n      }\n      getPageBookInfo()\n    }\n    onBeforeMount(()=>{\n      getBookType()\n    })\n\n    const router = useRouter()\n    // 查看书籍详细信息\n    function getBookDetail(id){\n      router.push({path:`/bookDetail/${id}`})\n    }\n\n    const UserInfoStore = useUserInfoStore();\n\n\n    // 借阅图书\n    const borrowBookVisible = shallowRef(false)\n    const borrowBookForm = shallowReactive({\n      // 借阅图书的id\n      bookId: null,\n      // 借阅的时长(天)\n      borrowTime: null,\n    })\n    function openBorrowBookDialog(bookId){\n      borrowBookVisible.value = true\n      borrowBookForm.bookId = bookId\n      borrowBookForm.borrowTime = 30\n    }\n    function borrowBook(){\n      borrowBookApi(markRaw(borrowBookForm))\n          .then(res=>{\n            // 借阅成功\n            ElMessage({type: 'success', message: res.message, showClose: true, duration: 5000})\n            // 刷新列表\n            getPageBookInfo()\n            // 刷新用户资源\n            UserInfoStore.getUserResource()\n            // 关闭对话框\n            borrowBookVisible.value = false\n          })\n    }\n\n\n    // 预约图书\n    const reserveBookVisible = shallowRef(false)\n    const reserveBookId = shallowRef(null)\n    function openReserveBookDialog(bookId){\n      reserveBookVisible.value = true\n      reserveBookId.value = bookId\n    }\n    function reserveBook(){\n      reserveBookApi(reserveBookId.value)\n        .then(res=>{\n          ElMessage({type: 'success', message: res.message, showClose: true, duration: 5000})\n          // 刷新列表\n          getPageBookInfo()\n          // 关闭对话框\n          reserveBookVisible.value = false\n        })\n    }\n\n    return {\n      tableRef, bookList,\n      pagination,pageChange,indexMethod,\n      queryForm,bookTypeList,queryBook,\n      getBookDetail,\n      UserInfoStore,\n      borrowBookVisible,openBorrowBookDialog,borrowBookForm,borrowBook,\n      reserveBookVisible, openReserveBookDialog,reserveBook\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.bookList{\n  padding: 0 20px 30px 20px;\n  height: 100%;\n  .el-form{\n    .el-form-item{\n      .el-input{\n        width: 200px;\n      }\n    }\n  }\n  .el-table{\n    .operation{\n      width: 100%;\n      height: 100%;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      >*{\n        margin: 0 2px 10px 2px;\n      }\n    }\n  }\n  .el-pagination{\n    margin-top: 10px;\n    ::v-deep{\n      .el-pager{\n        &>li:not(.is-active){\n          background-color: white;\n        }\n      }\n      &>.btn-prev,&>.btn-next{\n        &:not([disabled]){\n          background-color: white;\n        }\n      }\n    }\n  }\n  .borrowDialog::v-deep{\n    &>div{\n      font-weight: bold;\n    }\n    &>div:not(:last-child){\n      margin-bottom: 10px;\n    }\n  }\n}\n</style>\n"]}]}