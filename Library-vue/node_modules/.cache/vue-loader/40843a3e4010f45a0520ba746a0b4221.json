{"remainingRequest":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\admin\\BatchAddBook\\index.vue?vue&type=style&index=0&id=4eb88fe6&scoped=true&lang=scss","dependencies":[{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\admin\\BatchAddBook\\index.vue","mtime":1654054537000},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1749726397077},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1749726394932},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\postcss-loader\\src\\index.js","mtime":1749726394615},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1749726393347},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749726397539},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1749726393897}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5iYXRjaEFkZEJvb2t7CiAgcGFkZGluZzogMjBweCAzMHB4IDMwcHggMjBweDsKfQo="},{"version":3,"sources":["D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\admin\\BatchAddBook\\index.vue"],"names":[],"mappings":";AAoHA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC9B","file":"D:/桌面/前端交互/final/LibraryManagementSystem-master/Library-vue/src/views/admin/BatchAddBook/index.vue","sourceRoot":"","sourcesContent":["<template>\n  <div class=\"batchAddBook\">\n    <el-alert type=\"info\" show-icon title=\"通过上传Excel文件来批量导入图书\" :closable=\"false\"></el-alert>\n    <el-upload\n        ref=\"uploadRef\"\n        style=\"width: 500px;margin-top: 10px;\"\n        drag action=\"\" :auto-upload=\"false\" :limit=\"1\"\n        accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel\"\n        :on-change=\"fileChange\"\n        :on-exceed=\"fileExceed\"\n        :before-remove=\"removeFile\">\n      <el-icon class=\"el-icon--upload\"><upload-filled /></el-icon>\n      <div class=\"el-upload__text\">\n        拖拽文件到此处 或 <em>点击这里上传</em>\n      </div>\n      <template #tip>\n        <div class=\"el-upload__tip\" style=\"font-size: 14px\">\n          只允许接受.xls和.xlsx文件，一次只能上传 1 个文件\n        </div>\n      </template>\n    </el-upload>\n    <el-button type=\"success\" @click=\"uploadFile\">批量导入</el-button>\n    <el-button type=\"info\" @click=\"downloadTemplate\">模板文件下载</el-button>\n  </div>\n</template>\n\n<script>\nimport {UploadFilled} from '@element-plus/icons-vue'\nimport {shallowRef} from \"vue\";\nimport {ElMessage,genFileId} from \"element-plus\";\nimport {batchAddBookApi} from \"@/api/admin\";\n\nexport default {\n  name: \"BatchAddBook\",\n  components:{\n    UploadFilled\n  },\n  setup(){\n    // 下载批量导入的模板文件\n    function downloadTemplate(){\n      let publicPath = process.env.BASE_URL\n      let link = document.createElement('a')\n      link.style.display = 'none'\n      link.href = `${publicPath}批量导入图书模板.xls`\n      console.log(link.href)\n      document.body.appendChild(link)\n      link.click()\n      link.remove()\n    }\n\n    // 上传组件\n    const uploadRef = shallowRef()\n    const currentFile = shallowRef(null)\n    // 文件是否合法\n    function isFileAllowed(file){\n      // 判断文件的类型是否正确\n      const allowType = ['xls','xlsx']\n      let suffix = file.name.substring(file.name.lastIndexOf('.') + 1).toLowerCase()\n      if(allowType.indexOf(suffix) === -1){\n        return false\n      }\n      // 判断大小是否合理 小于2M\n      const limitSize = 1024 * 1024 * 2\n      return file.size <= limitSize;\n    }\n    // 当文件状态改变的时候触发，例如添加文件\n    function fileChange(file){\n      if(!isFileAllowed(file)){\n        ElMessage({type: 'warning',message: '文件不符合要求',duration: 5000,showClose: true})\n        uploadRef.value.handleRemove(file)\n      }else{\n        // 记录当前文件\n        currentFile.value = file.raw\n      }\n    }\n    // 当文件超出限制的时候\n    function fileExceed(files){\n      // 取第一个文件\n      let file = files[0]\n      if(!isFileAllowed(file)){\n        ElMessage({type: 'warning',message: '文件不符合要求',duration: 5000,showClose: true})\n      }else{\n        // 清空列表\n        uploadRef.value.clearFiles()\n        file.uid = genFileId()\n        // 设置第一个文件\n        uploadRef.value.handleStart(file)\n        // 记录当前文件\n        currentFile.value = file\n      }\n    }\n    // 文件移除\n    function removeFile(){\n      currentFile.value = null\n    }\n    // 上传文件\n    function uploadFile(){\n      if(currentFile.value){\n        batchAddBookApi(currentFile.value)\n          .then(()=>{\n            ElMessage({type: 'success',message: '上传文件成功',duration: 5000,showClose: true})\n            uploadRef.value.clearFiles()\n          })\n      }else {\n        ElMessage({type: 'error',message: '请先上传文件',duration: 5000,showClose: true})\n      }\n    }\n    return {\n      downloadTemplate,\n      uploadRef,fileChange,fileExceed,currentFile,removeFile,uploadFile\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.batchAddBook{\n  padding: 20px 30px 30px 20px;\n}\n</style>\n"]}]}