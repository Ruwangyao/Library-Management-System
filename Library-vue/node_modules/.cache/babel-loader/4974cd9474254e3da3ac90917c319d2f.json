{"remainingRequest":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\babel-loader\\lib\\index.js!D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\admin\\BatchAddBook\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\admin\\BatchAddBook\\index.vue","mtime":1654054537000},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\babel.config.js","mtime":1654054537000},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\unplugin\\dist\\webpack\\loaders\\transform.js","mtime":1749726393299},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\unplugin\\dist\\webpack\\loaders\\transform.js","mtime":1749726393299},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\unplugin\\dist\\webpack\\loaders\\transform.js","mtime":1749726393299},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\unplugin\\dist\\webpack\\loaders\\transform.js","mtime":1749726393299},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749726397539},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1749726398436},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749726397539},{"path":"D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1749726393897}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCB7IFVwbG9hZEZpbGxlZCB9IGZyb20gJ0BlbGVtZW50LXBsdXMvaWNvbnMtdnVlJzsKaW1wb3J0IHsgc2hhbGxvd1JlZiB9IGZyb20gInZ1ZSI7CmltcG9ydCB7IEVsTWVzc2FnZSwgZ2VuRmlsZUlkIH0gZnJvbSAiZWxlbWVudC1wbHVzIjsKaW1wb3J0IHsgYmF0Y2hBZGRCb29rQXBpIH0gZnJvbSAiQC9hcGkvYWRtaW4iOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkJhdGNoQWRkQm9vayIsCiAgY29tcG9uZW50czogewogICAgVXBsb2FkRmlsbGVkOiBVcGxvYWRGaWxsZWQKICB9LAogIHNldHVwOiBmdW5jdGlvbiBzZXR1cCgpIHsKICAgIC8vIOS4i+i9veaJuemHj+WvvOWFpeeahOaooeadv+aWh+S7tgogICAgZnVuY3Rpb24gZG93bmxvYWRUZW1wbGF0ZSgpIHsKICAgICAgdmFyIHB1YmxpY1BhdGggPSBwcm9jZXNzLmVudi5CQVNFX1VSTDsKICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgIGxpbmsuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgbGluay5ocmVmID0gIiIuY29uY2F0KHB1YmxpY1BhdGgsICJcdTYyNzlcdTkxQ0ZcdTVCRkNcdTUxNjVcdTU2RkVcdTRFNjZcdTZBMjFcdTY3N0YueGxzIik7CiAgICAgIGNvbnNvbGUubG9nKGxpbmsuaHJlZik7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgbGluay5yZW1vdmUoKTsKICAgIH0gLy8g5LiK5Lyg57uE5Lu2CgoKICAgIHZhciB1cGxvYWRSZWYgPSBzaGFsbG93UmVmKCk7CiAgICB2YXIgY3VycmVudEZpbGUgPSBzaGFsbG93UmVmKG51bGwpOyAvLyDmlofku7bmmK/lkKblkIjms5UKCiAgICBmdW5jdGlvbiBpc0ZpbGVBbGxvd2VkKGZpbGUpIHsKICAgICAgLy8g5Yik5pat5paH5Lu255qE57G75Z6L5piv5ZCm5q2j56GuCiAgICAgIHZhciBhbGxvd1R5cGUgPSBbJ3hscycsICd4bHN4J107CiAgICAgIHZhciBzdWZmaXggPSBmaWxlLm5hbWUuc3Vic3RyaW5nKGZpbGUubmFtZS5sYXN0SW5kZXhPZignLicpICsgMSkudG9Mb3dlckNhc2UoKTsKCiAgICAgIGlmIChhbGxvd1R5cGUuaW5kZXhPZihzdWZmaXgpID09PSAtMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAvLyDliKTmlq3lpKflsI/mmK/lkKblkIjnkIYg5bCP5LqOMk0KCgogICAgICB2YXIgbGltaXRTaXplID0gMTAyNCAqIDEwMjQgKiAyOwogICAgICByZXR1cm4gZmlsZS5zaXplIDw9IGxpbWl0U2l6ZTsKICAgIH0gLy8g5b2T5paH5Lu254q25oCB5pS55Y+Y55qE5pe25YCZ6Kem5Y+R77yM5L6L5aaC5re75Yqg5paH5Lu2CgoKICAgIGZ1bmN0aW9uIGZpbGVDaGFuZ2UoZmlsZSkgewogICAgICBpZiAoIWlzRmlsZUFsbG93ZWQoZmlsZSkpIHsKICAgICAgICBFbE1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLAogICAgICAgICAgbWVzc2FnZTogJ+aWh+S7tuS4jeespuWQiOimgeaxgicsCiAgICAgICAgICBkdXJhdGlvbjogNTAwMCwKICAgICAgICAgIHNob3dDbG9zZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHVwbG9hZFJlZi52YWx1ZS5oYW5kbGVSZW1vdmUoZmlsZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g6K6w5b2V5b2T5YmN5paH5Lu2CiAgICAgICAgY3VycmVudEZpbGUudmFsdWUgPSBmaWxlLnJhdzsKICAgICAgfQogICAgfSAvLyDlvZPmlofku7botoXlh7rpmZDliLbnmoTml7blgJkKCgogICAgZnVuY3Rpb24gZmlsZUV4Y2VlZChmaWxlcykgewogICAgICAvLyDlj5bnrKzkuIDkuKrmlofku7YKICAgICAgdmFyIGZpbGUgPSBmaWxlc1swXTsKCiAgICAgIGlmICghaXNGaWxlQWxsb3dlZChmaWxlKSkgewogICAgICAgIEVsTWVzc2FnZSh7CiAgICAgICAgICB0eXBlOiAnd2FybmluZycsCiAgICAgICAgICBtZXNzYWdlOiAn5paH5Lu25LiN56ym5ZCI6KaB5rGCJywKICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLAogICAgICAgICAgc2hvd0Nsb3NlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5riF56m65YiX6KGoCiAgICAgICAgdXBsb2FkUmVmLnZhbHVlLmNsZWFyRmlsZXMoKTsKICAgICAgICBmaWxlLnVpZCA9IGdlbkZpbGVJZCgpOyAvLyDorr7nva7nrKzkuIDkuKrmlofku7YKCiAgICAgICAgdXBsb2FkUmVmLnZhbHVlLmhhbmRsZVN0YXJ0KGZpbGUpOyAvLyDorrDlvZXlvZPliY3mlofku7YKCiAgICAgICAgY3VycmVudEZpbGUudmFsdWUgPSBmaWxlOwogICAgICB9CiAgICB9IC8vIOaWh+S7tuenu+mZpAoKCiAgICBmdW5jdGlvbiByZW1vdmVGaWxlKCkgewogICAgICBjdXJyZW50RmlsZS52YWx1ZSA9IG51bGw7CiAgICB9IC8vIOS4iuS8oOaWh+S7tgoKCiAgICBmdW5jdGlvbiB1cGxvYWRGaWxlKCkgewogICAgICBpZiAoY3VycmVudEZpbGUudmFsdWUpIHsKICAgICAgICBiYXRjaEFkZEJvb2tBcGkoY3VycmVudEZpbGUudmFsdWUpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgRWxNZXNzYWdlKHsKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgICBtZXNzYWdlOiAn5LiK5Lyg5paH5Lu25oiQ5YqfJywKICAgICAgICAgICAgZHVyYXRpb246IDUwMDAsCiAgICAgICAgICAgIHNob3dDbG9zZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICB1cGxvYWRSZWYudmFsdWUuY2xlYXJGaWxlcygpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIEVsTWVzc2FnZSh7CiAgICAgICAgICB0eXBlOiAnZXJyb3InLAogICAgICAgICAgbWVzc2FnZTogJ+ivt+WFiOS4iuS8oOaWh+S7ticsCiAgICAgICAgICBkdXJhdGlvbjogNTAwMCwKICAgICAgICAgIHNob3dDbG9zZTogdHJ1ZQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgZG93bmxvYWRUZW1wbGF0ZTogZG93bmxvYWRUZW1wbGF0ZSwKICAgICAgdXBsb2FkUmVmOiB1cGxvYWRSZWYsCiAgICAgIGZpbGVDaGFuZ2U6IGZpbGVDaGFuZ2UsCiAgICAgIGZpbGVFeGNlZWQ6IGZpbGVFeGNlZWQsCiAgICAgIGN1cnJlbnRGaWxlOiBjdXJyZW50RmlsZSwKICAgICAgcmVtb3ZlRmlsZTogcmVtb3ZlRmlsZSwKICAgICAgdXBsb2FkRmlsZTogdXBsb2FkRmlsZQogICAgfTsKICB9Cn07"},{"version":3,"mappings":"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","names":["UploadFilled","shallowRef","ElMessage","genFileId","batchAddBookApi","name","components","setup","downloadTemplate","publicPath","process","env","BASE_URL","link","document","createElement","style","display","href","console","log","body","appendChild","click","remove","uploadRef","currentFile","isFileAllowed","file","allowType","suffix","substring","lastIndexOf","toLowerCase","indexOf","limitSize","size","fileChange","type","message","duration","showClose","value","handleRemove","raw","fileExceed","files","clearFiles","uid","handleStart","removeFile","uploadFile","then"],"sourceRoot":"","sources":["D:\\桌面\\前端交互\\final\\LibraryManagementSystem-master\\Library-vue\\src\\views\\admin\\BatchAddBook\\index.vue"],"sourcesContent":["<template>\n  <div class=\"batchAddBook\">\n    <el-alert type=\"info\" show-icon title=\"通过上传Excel文件来批量导入图书\" :closable=\"false\"></el-alert>\n    <el-upload\n        ref=\"uploadRef\"\n        style=\"width: 500px;margin-top: 10px;\"\n        drag action=\"\" :auto-upload=\"false\" :limit=\"1\"\n        accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel\"\n        :on-change=\"fileChange\"\n        :on-exceed=\"fileExceed\"\n        :before-remove=\"removeFile\">\n      <el-icon class=\"el-icon--upload\"><upload-filled /></el-icon>\n      <div class=\"el-upload__text\">\n        拖拽文件到此处 或 <em>点击这里上传</em>\n      </div>\n      <template #tip>\n        <div class=\"el-upload__tip\" style=\"font-size: 14px\">\n          只允许接受.xls和.xlsx文件，一次只能上传 1 个文件\n        </div>\n      </template>\n    </el-upload>\n    <el-button type=\"success\" @click=\"uploadFile\">批量导入</el-button>\n    <el-button type=\"info\" @click=\"downloadTemplate\">模板文件下载</el-button>\n  </div>\n</template>\n\n<script>\nimport {UploadFilled} from '@element-plus/icons-vue'\nimport {shallowRef} from \"vue\";\nimport {ElMessage,genFileId} from \"element-plus\";\nimport {batchAddBookApi} from \"@/api/admin\";\n\nexport default {\n  name: \"BatchAddBook\",\n  components:{\n    UploadFilled\n  },\n  setup(){\n    // 下载批量导入的模板文件\n    function downloadTemplate(){\n      let publicPath = process.env.BASE_URL\n      let link = document.createElement('a')\n      link.style.display = 'none'\n      link.href = `${publicPath}批量导入图书模板.xls`\n      console.log(link.href)\n      document.body.appendChild(link)\n      link.click()\n      link.remove()\n    }\n\n    // 上传组件\n    const uploadRef = shallowRef()\n    const currentFile = shallowRef(null)\n    // 文件是否合法\n    function isFileAllowed(file){\n      // 判断文件的类型是否正确\n      const allowType = ['xls','xlsx']\n      let suffix = file.name.substring(file.name.lastIndexOf('.') + 1).toLowerCase()\n      if(allowType.indexOf(suffix) === -1){\n        return false\n      }\n      // 判断大小是否合理 小于2M\n      const limitSize = 1024 * 1024 * 2\n      return file.size <= limitSize;\n    }\n    // 当文件状态改变的时候触发，例如添加文件\n    function fileChange(file){\n      if(!isFileAllowed(file)){\n        ElMessage({type: 'warning',message: '文件不符合要求',duration: 5000,showClose: true})\n        uploadRef.value.handleRemove(file)\n      }else{\n        // 记录当前文件\n        currentFile.value = file.raw\n      }\n    }\n    // 当文件超出限制的时候\n    function fileExceed(files){\n      // 取第一个文件\n      let file = files[0]\n      if(!isFileAllowed(file)){\n        ElMessage({type: 'warning',message: '文件不符合要求',duration: 5000,showClose: true})\n      }else{\n        // 清空列表\n        uploadRef.value.clearFiles()\n        file.uid = genFileId()\n        // 设置第一个文件\n        uploadRef.value.handleStart(file)\n        // 记录当前文件\n        currentFile.value = file\n      }\n    }\n    // 文件移除\n    function removeFile(){\n      currentFile.value = null\n    }\n    // 上传文件\n    function uploadFile(){\n      if(currentFile.value){\n        batchAddBookApi(currentFile.value)\n          .then(()=>{\n            ElMessage({type: 'success',message: '上传文件成功',duration: 5000,showClose: true})\n            uploadRef.value.clearFiles()\n          })\n      }else {\n        ElMessage({type: 'error',message: '请先上传文件',duration: 5000,showClose: true})\n      }\n    }\n    return {\n      downloadTemplate,\n      uploadRef,fileChange,fileExceed,currentFile,removeFile,uploadFile\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.batchAddBook{\n  padding: 20px 30px 30px 20px;\n}\n</style>\n"]}]}